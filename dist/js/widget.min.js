if("undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json"),"undefined"==typeof config)var config={STORAGE_ENV:"prod"};var RiseVision=RiseVision||{};RiseVision.Image={},RiseVision.Image=function(e){"use strict";function t(){var e,t=null;g.className=d.position,g.className=d.scaleToFit?g.className+" scale-to-fit":g.className,document.body.style.background=d.background.color,0===Object.keys(d.storage).length?(e=d.url.split("?"),f=1===e.length?"?":"&",m=d.url+f+"cb="+(new Date).getTime(),g.style.backgroundImage="url("+m+")",i(),o()):(c=new RiseVision.Common.Message(document.getElementById("container"),document.getElementById("messageContainer")),c.show("Please wait while your image is downloaded."),t=new RiseVision.Image.Storage(d),t.init(),o())}function n(){c.show("The selected image does not exist.")}function i(){setTimeout(function(){m=d.url+f+"cb="+(new Date).getTime(),g.style.backgroundImage="url("+m+")",i()},p)}function s(e,n){Array.isArray(e)&&e.length>0&&"additionalParams"===e[0]&&Array.isArray(n)&&n.length>0&&(d=JSON.parse(n[0]),document.getElementById("container").style.height=u.getInt("rsH")+"px",t())}function o(){e.rpc.call("","rsevent_ready",null,u.getString("id"),!0,!1,!1,!0,!1)}function r(){RiseVision.Common.LoggerUtils.logEvent(l(),{event:"play",file_url:m})}function a(e){m=e,c.hide()}function l(){return"image_events"}var u=new e.Prefs,g=document.getElementById("image"),c=null,d=null,m=null,f="",p=3e5;return{getAdditionalParams:s,getTableName:l,noStorageFile:n,play:r,storageFileUpdate:a}}(gadgets);var WIDGET_COMMON_CONFIG={AUTH_PATH_URL:"v1/widget/auth",LOGGER_CLIENT_ID:"1088527147109-6q1o2vtihn34292pjt4ckhmhck0rk0o7.apps.googleusercontent.com",LOGGER_CLIENT_SECRET:"nlZyrcPLg6oEwO9f9Wfn29Wh",LOGGER_REFRESH_TOKEN:"1/xzt4kwzE1H7W9VnKB8cAaCx6zb4Es4nKEoqaYHdTD15IgOrJDtdun6zK6XiATCKT",STORAGE_ENV:"prod",STORE_URL:"https://store-dot-rvaserver2.appspot.com/"},RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,t){"use strict";function n(){try{t.style.height=e.style.height}catch(n){console.warn("Can't initialize Message - ",n.message)}}function i(){if(o){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none",e.style.visibility="visible",o=!1}}function s(n){var i,s=document.createDocumentFragment();o?(i=t.querySelector(".message"),i.innerHTML=n):(e.style.visibility="hidden",t.style.display="block",i=document.createElement("p"),i.innerHTML=n,i.setAttribute("class","message"),s.appendChild(i),t.appendChild(s),o=!0)}var o=!1;return n(),{hide:i,show:s}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(e){"use strict";function t(e,t){Array.isArray(e)&&e.length>0&&Array.isArray(t)&&t.length>0&&("companyId"===e[0]&&(g=t[0]),"displayId"===e[1]&&(u=t[1]?t[1]:"preview"),c(g,u))}function n(e,t){var n=null;e.event?(n={},n.event=e.event,e.event_details&&(n.event_details=e.event_details),e.file_url&&(n.file_url=e.file_url,n.file_format=s(e.file_url)),i(function(e,i){n.company_id=e,n.display_id=i,t(n)})):t(n)}function i(n){n&&"function"==typeof n&&(c=n,g&&u?c(g,u):l&&""!==l&&(e.rpc.register("rsparam_set_"+l,t),e.rpc.call("","rsparam_get",null,l,["companyId","displayId"])))}function s(e){var t,n=/[?#&]/;return e&&"string"==typeof e?(t=e.substr(e.lastIndexOf(".")+1),n.test(t)&&(t=t.substr(0,-1!==t.indexOf("?")?t.indexOf("?"):t.length),t=t.substr(0,-1!==t.indexOf("#")?t.indexOf("#"):t.length),t=t.substr(0,-1!==t.indexOf("&")?t.indexOf("&"):t.length)),t.toLowerCase()):null}function o(e){var t=JSON.parse(JSON.stringify(d));return t.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),t.rows[0].json=JSON.parse(JSON.stringify(e)),t.rows[0].json.ts=(new Date).toISOString(),t}function r(e){var t=new Date,n=t.getUTCFullYear(),i=t.getUTCMonth()+1,s=t.getUTCDate();return 10>i&&(i="0"+i),10>s&&(s="0"+s),e+n+i+s}function a(e,t){n(t,function(t){null!==t&&RiseVision.Common.Logger.log(e,t)})}var l=(new e.Prefs).getString("id"),u="",g="",c=null,d={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,rows:[{insertId:""}]};return{getIds:i,getInsertData:o,getFileFormat:s,getTable:r,logEvent:a}}(gadgets),RiseVision.Common.Logger=function(e){"use strict";function t(e){var t=new XMLHttpRequest;return new Date-u<358e4?e({}):(t.open("POST",s,!0),t.onloadend=function(){var n=JSON.parse(t.response);e({token:n.access_token,refreshedAt:new Date})},t.send(),void 0)}function n(e){return r&&l===e}function i(i,s){function c(t){var n,r,a=new XMLHttpRequest;r=o.replace("TABLE_ID",e.getTable(i)),u=t.refreshedAt||u,g=t.token||g,n=e.getInsertData(s),a.open("POST",r,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+g),s.cb&&"function"==typeof s.cb&&(a.onloadend=function(){s.cb(a.response)}),a.send(JSON.stringify(n))}if(!(!i||!s||s.hasOwnProperty("event")&&!s.event||s.hasOwnProperty("event")&&n(s.event)))return r=!0,l=s.event,setTimeout(function(){r=!1},a),t(c)}var s="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",o="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",r=!1,a=1e3,l="",u=0,g="";return{log:i}}(RiseVision.Common.LoggerUtils);var RiseVision=RiseVision||{};RiseVision.Image=RiseVision.Image||{},RiseVision.Image.Storage=function(e){"use strict";function t(){var t=document.querySelector("rise-storage"),n=document.getElementById("image"),i=RiseVision.Image.getTableName(),s="";t.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.url&&(s=e.detail.url.replace("'","\\'"),n.style.backgroundImage="url('"+s+"')",RiseVision.Image.storageFileUpdate(s))}),t.addEventListener("rise-storage-no-file",function(e){var t={event:"error",event_details:"storage file not found",file_url:e.detail};n.style.background="",RiseVision.Common.LoggerUtils.logEvent(i,t),RiseVision.Image.noStorageFile()}),t.addEventListener("rise-storage-file-throttled",function(e){var t={event:"error",event_details:"storage file throttled",file_url:e.detail};RiseVision.Common.LoggerUtils.logEvent(i,t)}),t.addEventListener("rise-storage-error",function(e){var t=e.detail&&e.detail.request&&e.detail.request.url?e.detail.request.url:null,n={event:"error",event_details:"storage error",file_url:t};RiseVision.Common.LoggerUtils.logEvent(i,n)}),t.addEventListener("rise-cache-error",function(e){var t=e.detail&&e.detail.request&&e.detail.request.url?e.detail.request.url:null,n={event:"error",event_details:"cache error",file_url:t};RiseVision.Common.LoggerUtils.logEvent(i,n)}),t.setAttribute("folder",e.storage.folder),t.setAttribute("fileName",e.storage.fileName),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("env",config.STORAGE_ENV),t.go()}return{init:t}},function(e,t,n){"use strict";function i(){RiseVision.Image.play()}var s=(new n.Prefs).getString("id");e.oncontextmenu=function(){return!1},t.body.onmousedown=function(){return!1},e.addEventListener("WebComponentsReady",function(){s&&""!==s&&(n.rpc.register("rscmd_play_"+s,i),n.rpc.register("rsparam_set_"+s,RiseVision.Image.getAdditionalParams),n.rpc.call("","rsparam_get",null,s,["additionalParams"]))})}(window,document,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-3"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiY29uZmlnIiwiU1RPUkFHRV9FTlYiLCJSaXNlVmlzaW9uIiwiSW1hZ2UiLCJnYWRnZXRzIiwiaW5pdCIsInN0ciIsInN0b3JhZ2UiLCJpbWciLCJjbGFzc05hbWUiLCJwYXJhbXMiLCJwb3NpdGlvbiIsInNjYWxlVG9GaXQiLCJkb2N1bWVudCIsImJvZHkiLCJzdHlsZSIsImJhY2tncm91bmQiLCJjb2xvciIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJ1cmwiLCJzcGxpdCIsInNlcGFyYXRvciIsImZpbGVVcmwiLCJEYXRlIiwiZ2V0VGltZSIsImJhY2tncm91bmRJbWFnZSIsInN0YXJ0VGltZXIiLCJyZWFkeSIsIm1lc3NhZ2UiLCJDb21tb24iLCJNZXNzYWdlIiwiZ2V0RWxlbWVudEJ5SWQiLCJzaG93IiwiU3RvcmFnZSIsIm5vU3RvcmFnZUZpbGUiLCJzZXRUaW1lb3V0IiwicmVmcmVzaEludGVydmFsIiwiZ2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwiSlNPTiIsInBhcnNlIiwiaGVpZ2h0IiwicHJlZnMiLCJnZXRJbnQiLCJycGMiLCJjYWxsIiwiZ2V0U3RyaW5nIiwicGxheSIsIkxvZ2dlclV0aWxzIiwibG9nRXZlbnQiLCJnZXRUYWJsZU5hbWUiLCJldmVudCIsImZpbGVfdXJsIiwic3RvcmFnZUZpbGVVcGRhdGUiLCJoaWRlIiwiUHJlZnMiLCJXSURHRVRfQ09NTU9OX0NPTkZJRyIsIkFVVEhfUEFUSF9VUkwiLCJMT0dHRVJfQ0xJRU5UX0lEIiwiTE9HR0VSX0NMSUVOVF9TRUNSRVQiLCJMT0dHRVJfUkVGUkVTSF9UT0tFTiIsIlNUT1JFX1VSTCIsIm1haW5Db250YWluZXIiLCJtZXNzYWdlQ29udGFpbmVyIiwiX2luaXQiLCJlIiwiY29uc29sZSIsIndhcm4iLCJfYWN0aXZlIiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwiZGlzcGxheSIsInZpc2liaWxpdHkiLCJwIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJhcHBlbmRDaGlsZCIsInNldElkcyIsImNvbXBhbnlJZCIsImRpc3BsYXlJZCIsImNhbGxiYWNrIiwiZ2V0RXZlbnRQYXJhbXMiLCJjYiIsImpzb24iLCJldmVudF9kZXRhaWxzIiwiZmlsZV9mb3JtYXQiLCJnZXRGaWxlRm9ybWF0IiwiZ2V0SWRzIiwiY29tcGFueV9pZCIsImRpc3BsYXlfaWQiLCJpZCIsInJlZ2lzdGVyIiwiaGFzUGFyYW1zIiwic3Vic3RyIiwibGFzdEluZGV4T2YiLCJ0ZXN0IiwiaW5kZXhPZiIsInRvTG93ZXJDYXNlIiwiZ2V0SW5zZXJ0RGF0YSIsImRhdGEiLCJzdHJpbmdpZnkiLCJCQVNFX0lOU0VSVF9TQ0hFTUEiLCJyb3dzIiwiaW5zZXJ0SWQiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJ0b1VwcGVyQ2FzZSIsInRzIiwidG9JU09TdHJpbmciLCJnZXRUYWJsZSIsIm5hbWUiLCJkYXRlIiwieWVhciIsImdldFVUQ0Z1bGxZZWFyIiwibW9udGgiLCJnZXRVVENNb250aCIsImRheSIsImdldFVUQ0RhdGUiLCJ0YWJsZSIsIkxvZ2dlciIsImxvZyIsImtpbmQiLCJza2lwSW52YWxpZFJvd3MiLCJpZ25vcmVVbmtub3duVmFsdWVzIiwidXRpbHMiLCJyZWZyZXNoVG9rZW4iLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsInJlZnJlc2hEYXRlIiwib3BlbiIsIlJFRlJFU0hfVVJMIiwib25sb2FkZW5kIiwicmVzcCIsInJlc3BvbnNlIiwidG9rZW4iLCJhY2Nlc3NfdG9rZW4iLCJyZWZyZXNoZWRBdCIsInNlbmQiLCJpc1Rocm90dGxlZCIsInRocm90dGxlIiwibGFzdEV2ZW50IiwidGFibGVOYW1lIiwiaW5zZXJ0V2l0aFRva2VuIiwicmVmcmVzaERhdGEiLCJpbnNlcnREYXRhIiwic2VydmljZVVybCIsInJlcGxhY2UiLCJzZXRSZXF1ZXN0SGVhZGVyIiwiaGFzT3duUHJvcGVydHkiLCJ0aHJvdHRsZURlbGF5IiwiYWRkRXZlbnRMaXN0ZW5lciIsImRldGFpbCIsInJlcXVlc3QiLCJmb2xkZXIiLCJmaWxlTmFtZSIsImdvIiwid2luZG93Iiwib25jb250ZXh0bWVudSIsIm9ubW91c2Vkb3duIiwiX2dhcSIsInB1c2giLCJnYSIsInR5cGUiLCJhc3luYyIsInNyYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIl0sIm1hcHBpbmdzIjoiQUFRQSxHQU51QixtQkFBWkEsVUFDVEEsUUFBUUMsT0FBTyxvQ0FDWkMsU0FBUyxpQkFBa0Isd0JBQzNCQSxTQUFTLGdCQUFpQixTQUdULG1CQUFYQyxRQUNULEdBQUlBLFNBQ0ZDLFlBQWEsT0FNakIsSUFBSUMsWUFBYUEsY0FDakJBLFlBQVdDLFNBRVhELFdBQVdDLE1BQVEsU0FBV0MsR0FDNUIsWUFhQSxTQUFTQyxLQUNQLEdBQ0VDLEdBREVDLEVBQVUsSUFHZEMsR0FBSUMsVUFBWUMsRUFBT0MsU0FDdkJILEVBQUlDLFVBQVlDLEVBQU9FLFdBQWFKLEVBQUlDLFVBQVksZ0JBQWtCRCxFQUFJQyxVQUMxRUksU0FBU0MsS0FBS0MsTUFBTUMsV0FBYU4sRUFBT00sV0FBV0MsTUFHUixJQUF2Q0MsT0FBT0MsS0FBS1QsRUFBT0gsU0FBU2EsUUFDOUJkLEVBQU1JLEVBQU9XLElBQUlDLE1BQU0sS0FHckJDLEVBRGlCLElBQWZqQixFQUFJYyxPQUNNLElBR0EsSUFHZEksRUFBVWQsRUFBT1csSUFBTUUsRUFBWSxPQUFRLEdBQUlFLE9BQU9DLFVBQ3REbEIsRUFBSU8sTUFBTVksZ0JBQWtCLE9BQVNILEVBQVUsSUFFL0NJLElBQ0FDLE1BS0FDLEVBQVUsR0FBSTVCLFlBQVc2QixPQUFP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bUQsU0FBUyxjQUFnQkQsRUFBSS9DLEdBQ3pDaEQsRUFBUTZDLElBQUltRCxTQUFTLGVBQWlCRCxFQUFJakcsV0FBV0MsTUFBTW9DLHFCQUMzRG5DLEVBQVE2QyxJQUFJQyxLQUFLLEdBQUksY0FBZSxLQUFNaUQsR0FBSyx5QkFPbERtRSxPQUFRekosU0FBVVQsUUFHckIsSUFBSXFLLE1BQU9BLFFBRVhBLE1BQUtDLE1BQU0sY0FBZSxrQkFDMUJELEtBQUtDLE1BQU0sbUJBRVgsV0FDRSxHQUFJQyxHQUFLOUosU0FBU3NFLGNBQWMsU0FBV3dGLEdBQUdDLEtBQU8sa0JBQW1CRCxFQUFHRSxPQUFRLEVBQ25GRixFQUFHRyxLQUFPLFVBQVlqSyxTQUFTa0ssU0FBU0MsU0FBVyxjQUFnQixjQUFnQiw2QkFDbkYsSUFBSUMsR0FBSXBLLFNBQVNxSyxxQkFBcUIsVUFBVSxFQUFJRCxHQUFFRSxXQUFXQyxhQUFhVCxFQUFJTSIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGNvbmZpZzogdHJ1ZSAqL1xuLyogZXhwb3J0ZWQgY29uZmlnICovXG5pZiAodHlwZW9mIGFuZ3VsYXIgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLmNvbW1vbi5pMThuLmNvbmZpZ1wiLCBbXSlcbiAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImxvY2FsZXMvdHJhbnNsYXRpb25fXCIpXG4gICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xufVxuXG5pZiAodHlwZW9mIGNvbmZpZyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICB2YXIgY29uZmlnID0ge1xuICAgIFNUT1JBR0VfRU5WOiBcInByb2RcIlxuICB9O1xufVxuXG4vKiBnbG9iYWwgZ2FkZ2V0cyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkltYWdlID0ge307XG5cblJpc2VWaXNpb24uSW1hZ2UgPSAoZnVuY3Rpb24gKGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKSxcbiAgICBpbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImltYWdlXCIpLFxuICAgIG1lc3NhZ2UgPSBudWxsLFxuICAgIHBhcmFtcyA9IG51bGwsXG4gICAgZmlsZVVybCA9IG51bGwsXG4gICAgc2VwYXJhdG9yID0gXCJcIixcbiAgICByZWZyZXNoSW50ZXJ2YWwgPSAzMDAwMDA7ICAvLyA1IG1pbnV0ZXNcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBzdG9yYWdlID0gbnVsbCxcbiAgICAgIHN0cjtcblxuICAgIGltZy5jbGFzc05hbWUgPSBwYXJhbXMucG9zaXRpb247XG4gICAgaW1nLmNsYXNzTmFtZSA9IHBhcmFtcy5zY2FsZVRvRml0ID8gaW1nLmNsYXNzTmFtZSArIFwiIHNjYWxlLXRvLWZpdFwiIDogaW1nLmNsYXNzTmFtZTtcbiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmJhY2tncm91bmQgPSBwYXJhbXMuYmFja2dyb3VuZC5jb2xvcjtcblxuICAgIC8vIFRoaXJkIHBhcnR5IFVSTFxuICAgIGlmIChPYmplY3Qua2V5cyhwYXJhbXMuc3RvcmFnZSkubGVuZ3RoID09PSAwKSB7XG4gICAgICBzdHIgPSBwYXJhbXMudXJsLnNwbGl0KFwiP1wiKTtcblxuICAgICAgaWYgKHN0ci5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgc2VwYXJhdG9yID0gXCI/XCI7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgc2VwYXJhdG9yID0gXCImXCI7XG4gICAgICB9XG5cbiAgICAgIGZpbGVVcmwgPSBwYXJhbXMudXJsICsgc2VwYXJhdG9yICsgXCJjYj1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgaW1nLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgZmlsZVVybCArIFwiKVwiO1xuXG4gICAgICBzdGFydFRpbWVyKCk7XG4gICAgICByZWFkeSgpO1xuICAgIH1cbiAgICAvLyBSaXNlIFN0b3JhZ2VcbiAgICBlbHNlIHtcbiAgICAgIC8vIGNyZWF0ZSBpbnN0YW5jZSBvZiBtZXNzYWdlXG4gICAgICBtZXNzYWdlID0gbmV3IFJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb250YWluZXJcIiksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWVzc2FnZUNvbnRhaW5lclwiKSk7XG5cbiAgICAgIC8vIHNob3cgd2FpdCBtZXNzYWdlIHdoaWxlIFN0b3JhZ2UgaW5pdGlhbGl6ZXNcbiAgICAgIG1lc3NhZ2Uuc2hvdyhcIlBsZWFzZSB3YWl0IHdoaWxlIHlvdXIgaW1hZ2UgaXMgZG93bmxvYWRlZC5cIik7XG5cbiAgICAgIHN0b3JhZ2UgPSBuZXcgUmlzZVZpc2lvbi5JbWFnZS5TdG9yYWdlKHBhcmFtcyk7XG4gICAgICBzdG9yYWdlLmluaXQoKTtcblxuICAgICAgcmVhZHkoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBub1N0b3JhZ2VGaWxlKCkge1xuICAgIG1lc3NhZ2Uuc2hvdyhcIlRoZSBzZWxlY3RlZCBpbWFnZSBkb2VzIG5vdCBleGlzdC5cIik7XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydFRpbWVyKCkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBmaWxlVXJsID0gcGFyYW1zLnVybCArIHNlcGFyYXRvciArIFwiY2I9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgIGltZy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGZpbGVVcmwgKyBcIilcIjtcblxuICAgICAgc3RhcnRUaW1lcigpO1xuICAgIH0sIHJlZnJlc2hJbnRlcnZhbCk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGdldEFkZGl0aW9uYWxQYXJhbXMobmFtZXMsIHZhbHVlcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIG5hbWVzWzBdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBwYXJhbXMgPSBKU09OLnBhcnNlKHZhbHVlc1swXSk7XG5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb250YWluZXJcIikuc3R5bGUuaGVpZ2h0ID0gcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuICAgICAgICBpbml0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcmVhZHkoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksIHRydWUsXG4gICAgICBmYWxzZSwgZmFsc2UsIHRydWUsIGZhbHNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyVXRpbHMubG9nRXZlbnQoZ2V0VGFibGVOYW1lKCksIHsgXCJldmVudFwiOiBcInBsYXlcIiwgXCJmaWxlX3VybFwiOiBmaWxlVXJsIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcmFnZUZpbGVVcGRhdGUodXJsKSB7XG4gICAgZmlsZVVybCA9IHVybDtcblxuICAgIC8vIHJlbW92ZSBhIG1lc3NhZ2UgcHJldmlvdXNseSBzaG93blxuICAgIG1lc3NhZ2UuaGlkZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0VGFibGVOYW1lKCkge1xuICAgIHJldHVybiBcImltYWdlX2V2ZW50c1wiO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImdldEFkZGl0aW9uYWxQYXJhbXNcIjogZ2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcImdldFRhYmxlTmFtZVwiOiBnZXRUYWJsZU5hbWUsXG4gICAgXCJub1N0b3JhZ2VGaWxlXCI6IG5vU3RvcmFnZUZpbGUsXG4gICAgXCJwbGF5XCI6IHBsYXksXG4gICAgXCJzdG9yYWdlRmlsZVVwZGF0ZVwiOiBzdG9yYWdlRmlsZVVwZGF0ZVxuICB9O1xufSkoZ2FkZ2V0cyk7XG5cbnZhciBXSURHRVRfQ09NTU9OX0NPTkZJRyA9IHtcbiAgQVVUSF9QQVRIX1VSTDogXCJ2MS93aWRnZXQvYXV0aFwiLFxuICBMT0dHRVJfQ0xJRU5UX0lEOiBcIjEwODg1MjcxNDcxMDktNnExbzJ2dGlobjM0MjkycGp0NGNraG1oY2swcmswbzcuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb21cIixcbiAgTE9HR0VSX0NMSUVOVF9TRUNSRVQ6IFwibmxaeXJjUExnNm9Fd085ZjlXZm4yOVdoXCIsXG4gIExPR0dFUl9SRUZSRVNIX1RPS0VOOiBcIjEveHp0NGt3ekUxSDdXOVZuS0I4Y0FhQ3g2emI0RXM0bktFb3FhWUhkVEQxNUlnT3JKRHRkdW42eks2WGlBVENLVFwiLFxuICBTVE9SQUdFX0VOVjogXCJwcm9kXCIsXG4gIFNUT1JFX1VSTDogXCJodHRwczovL3N0b3JlLWRvdC1ydmFzZXJ2ZXIyLmFwcHNwb3QuY29tL1wiXG59O1xudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uTWVzc2FnZSA9IGZ1bmN0aW9uIChtYWluQ29udGFpbmVyLCBtZXNzYWdlQ29udGFpbmVyKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWN0aXZlID0gZmFsc2U7XG5cbiAgZnVuY3Rpb24gX2luaXQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gbWFpbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS53YXJuKFwiQ2FuJ3QgaW5pdGlhbGl6ZSBNZXNzYWdlIC0gXCIsIGUubWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmIChfYWN0aXZlKSB7XG4gICAgICAvLyBjbGVhciBjb250ZW50IG9mIG1lc3NhZ2UgY29udGFpbmVyXG4gICAgICB3aGlsZSAobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XG4gICAgICAgIG1lc3NhZ2VDb250YWluZXIucmVtb3ZlQ2hpbGQobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKTtcbiAgICAgIH1cblxuICAgICAgLy8gaGlkZSBtZXNzYWdlIGNvbnRhaW5lclxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICAgIC8vIHNob3cgbWFpbiBjb250YWluZXJcbiAgICAgIG1haW5Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuXG4gICAgICBfYWN0aXZlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc2hvdyhtZXNzYWdlKSB7XG4gICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLFxuICAgICAgcDtcblxuICAgIGlmICghX2FjdGl2ZSkge1xuICAgICAgLy8gaGlkZSBtYWluIGNvbnRhaW5lclxuICAgICAgbWFpbkNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcblxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXG4gICAgICAvLyBjcmVhdGUgbWVzc2FnZSBlbGVtZW50XG4gICAgICBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgICBwLmlubmVySFRNTCA9IG1lc3NhZ2U7XG4gICAgICBwLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibWVzc2FnZVwiKTtcblxuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQocCk7XG4gICAgICBtZXNzYWdlQ29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWdtZW50KTtcblxuICAgICAgX2FjdGl2ZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIG1lc3NhZ2UgYWxyZWFkeSBiZWluZyBzaG93biwgdXBkYXRlIG1lc3NhZ2UgdGV4dFxuICAgICAgcCA9IG1lc3NhZ2VDb250YWluZXIucXVlcnlTZWxlY3RvcihcIi5tZXNzYWdlXCIpO1xuICAgICAgcC5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgIH1cbiAgfVxuXG4gIF9pbml0KCk7XG5cbiAgcmV0dXJuIHtcbiAgICBcImhpZGVcIjogaGlkZSxcbiAgICBcInNob3dcIjogc2hvd1xuICB9O1xufTtcblxuLyogZ2xvYmFsIGdhZGdldHMgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyVXRpbHMgPSAoZnVuY3Rpb24oZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAgdmFyIGlkID0gbmV3IGdhZGdldHMuUHJlZnMoKS5nZXRTdHJpbmcoXCJpZFwiKSxcbiAgICBkaXNwbGF5SWQgPSBcIlwiLFxuICAgIGNvbXBhbnlJZCA9IFwiXCIsXG4gICAgY2FsbGJhY2sgPSBudWxsO1xuXG4gIHZhciBCQVNFX0lOU0VSVF9TQ0hFTUEgPVxuICB7XG4gICAgXCJraW5kXCI6IFwiYmlncXVlcnkjdGFibGVEYXRhSW5zZXJ0QWxsUmVxdWVzdFwiLFxuICAgIFwic2tpcEludmFsaWRSb3dzXCI6IGZhbHNlLFxuICAgIFwiaWdub3JlVW5rbm93blZhbHVlc1wiOiBmYWxzZSxcbiAgICBcInJvd3NcIjogW3tcbiAgICAgIFwiaW5zZXJ0SWRcIjogXCJcIlxuICAgIH1dXG4gIH07XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cblxuICAvKiBTZXQgdGhlIENvbXBhbnkgYW5kIERpc3BsYXkgSURzLiAqL1xuICBmdW5jdGlvbiBzZXRJZHMobmFtZXMsIHZhbHVlcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlmIChuYW1lc1swXSA9PT0gXCJjb21wYW55SWRcIikge1xuICAgICAgICAgIGNvbXBhbnlJZCA9IHZhbHVlc1swXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuYW1lc1sxXSA9PT0gXCJkaXNwbGF5SWRcIikge1xuICAgICAgICAgIGlmICh2YWx1ZXNbMV0pIHtcbiAgICAgICAgICAgIGRpc3BsYXlJZCA9IHZhbHVlc1sxXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkaXNwbGF5SWQgPSBcInByZXZpZXdcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjYWxsYmFjayhjb21wYW55SWQsIGRpc3BsYXlJZCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyogUmV0cmlldmUgcGFyYW1ldGVycyB0byBwYXNzIHRvIHRoZSBldmVudCBsb2dnZXIuICovXG4gIGZ1bmN0aW9uIGdldEV2ZW50UGFyYW1zKHBhcmFtcywgY2IpIHtcbiAgICB2YXIganNvbiA9IG51bGw7XG5cbiAgICAvLyBldmVudCBpcyByZXF1aXJlZC5cbiAgICBpZiAocGFyYW1zLmV2ZW50KSB7XG4gICAgICBqc29uID0ge307XG4gICAgICBqc29uLmV2ZW50ID0gcGFyYW1zLmV2ZW50O1xuXG4gICAgICBpZiAocGFyYW1zLmV2ZW50X2RldGFpbHMpIHtcbiAgICAgICAganNvbi5ldmVudF9kZXRhaWxzID0gcGFyYW1zLmV2ZW50X2RldGFpbHM7XG4gICAgICB9XG5cbiAgICAgIGlmIChwYXJhbXMuZmlsZV91cmwpIHtcbiAgICAgICAganNvbi5maWxlX3VybCA9IHBhcmFtcy5maWxlX3VybDtcbiAgICAgICAganNvbi5maWxlX2Zvcm1hdCA9IGdldEZpbGVGb3JtYXQocGFyYW1zLmZpbGVfdXJsKTtcbiAgICAgIH1cblxuICAgICAgZ2V0SWRzKGZ1bmN0aW9uKGNvbXBhbnlJZCwgZGlzcGxheUlkKSB7XG4gICAgICAgIGpzb24uY29tcGFueV9pZCA9IGNvbXBhbnlJZDtcbiAgICAgICAganNvbi5kaXNwbGF5X2lkID0gZGlzcGxheUlkO1xuXG4gICAgICAgIGNiKGpzb24pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY2IoanNvbik7XG4gICAgfVxuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBnZXRJZHMoY2IpIHtcbiAgICBpZiAoIWNiIHx8IHR5cGVvZiBjYiAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY2FsbGJhY2sgPSBjYjtcbiAgICB9XG5cbiAgICBpZiAoY29tcGFueUlkICYmIGRpc3BsYXlJZCkge1xuICAgICAgY2FsbGJhY2soY29tcGFueUlkLCBkaXNwbGF5SWQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIHNldElkcyk7XG4gICAgICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiY29tcGFueUlkXCIsIFwiZGlzcGxheUlkXCJdKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRGaWxlRm9ybWF0KHVybCkge1xuICAgIHZhciBoYXNQYXJhbXMgPSAvWz8jJl0vLFxuICAgICAgc3RyO1xuXG4gICAgaWYgKCF1cmwgfHwgdHlwZW9mIHVybCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgc3RyID0gdXJsLnN1YnN0cih1cmwubGFzdEluZGV4T2YoXCIuXCIpICsgMSk7XG5cbiAgICAvLyBkb24ndCBpbmNsdWRlIGFueSBwYXJhbXMgYWZ0ZXIgdGhlIGZpbGVuYW1lXG4gICAgaWYgKGhhc1BhcmFtcy50ZXN0KHN0cikpIHtcbiAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCAsKHN0ci5pbmRleE9mKFwiP1wiKSAhPT0gLTEpID8gc3RyLmluZGV4T2YoXCI/XCIpIDogc3RyLmxlbmd0aCk7XG5cbiAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCwgKHN0ci5pbmRleE9mKFwiI1wiKSAhPT0gLTEpID8gc3RyLmluZGV4T2YoXCIjXCIpIDogc3RyLmxlbmd0aCk7XG5cbiAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCwgKHN0ci5pbmRleE9mKFwiJlwiKSAhPT0gLTEpID8gc3RyLmluZGV4T2YoXCImXCIpIDogc3RyLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0ci50b0xvd2VyQ2FzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0SW5zZXJ0RGF0YShwYXJhbXMpIHtcbiAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoQkFTRV9JTlNFUlRfU0NIRU1BKSk7XG5cbiAgICBkYXRhLnJvd3NbMF0uaW5zZXJ0SWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMikudG9VcHBlckNhc2UoKTtcbiAgICBkYXRhLnJvd3NbMF0uanNvbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7XG4gICAgZGF0YS5yb3dzWzBdLmpzb24udHMgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFRhYmxlKG5hbWUpIHtcbiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCksXG4gICAgICB5ZWFyID0gZGF0ZS5nZXRVVENGdWxsWWVhcigpLFxuICAgICAgbW9udGggPSBkYXRlLmdldFVUQ01vbnRoKCkgKyAxLFxuICAgICAgZGF5ID0gZGF0ZS5nZXRVVENEYXRlKCk7XG5cbiAgICBpZiAobW9udGggPCAxMCkge1xuICAgICAgbW9udGggPSBcIjBcIiArIG1vbnRoO1xuICAgIH1cblxuICAgIGlmIChkYXkgPCAxMCkge1xuICAgICAgZGF5ID0gXCIwXCIgKyBkYXk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5hbWUgKyB5ZWFyICsgbW9udGggKyBkYXk7XG4gIH1cblxuICBmdW5jdGlvbiBsb2dFdmVudCh0YWJsZSwgcGFyYW1zKSB7XG4gICAgZ2V0RXZlbnRQYXJhbXMocGFyYW1zLCBmdW5jdGlvbihqc29uKSB7XG4gICAgICBpZiAoanNvbiAhPT0gbnVsbCkge1xuICAgICAgICBSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXIubG9nKHRhYmxlLCBqc29uKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJnZXRJZHNcIjogZ2V0SWRzLFxuICAgIFwiZ2V0SW5zZXJ0RGF0YVwiOiBnZXRJbnNlcnREYXRhLFxuICAgIFwiZ2V0RmlsZUZvcm1hdFwiOiBnZXRGaWxlRm9ybWF0LFxuICAgIFwiZ2V0VGFibGVcIjogZ2V0VGFibGUsXG4gICAgXCJsb2dFdmVudFwiOiBsb2dFdmVudFxuICB9O1xufSkoZ2FkZ2V0cyk7XG5cblJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlciA9IChmdW5jdGlvbih1dGlscykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgUkVGUkVTSF9VUkwgPSBcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92My90b2tlbj9jbGllbnRfaWQ9XCIgKyBXSURHRVRfQ09NTU9OX0NPTkZJRy5MT0dHRVJfQ0xJRU5UX0lEICtcbiAgICAgIFwiJmNsaWVudF9zZWNyZXQ9XCIgKyBXSURHRVRfQ09NTU9OX0NPTkZJRy5MT0dHRVJfQ0xJRU5UX1NFQ1JFVCArXG4gICAgICBcIiZyZWZyZXNoX3Rva2VuPVwiICsgV0lER0VUX0NPTU1PTl9DT05GSUcuTE9HR0VSX1JFRlJFU0hfVE9LRU4gK1xuICAgICAgXCImZ3JhbnRfdHlwZT1yZWZyZXNoX3Rva2VuXCI7XG5cbiAgdmFyIHNlcnZpY2VVcmwgPSBcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL2JpZ3F1ZXJ5L3YyL3Byb2plY3RzL2NsaWVudC1zaWRlLWV2ZW50cy9kYXRhc2V0cy9XaWRnZXRfRXZlbnRzL3RhYmxlcy9UQUJMRV9JRC9pbnNlcnRBbGxcIixcbiAgICB0aHJvdHRsZSA9IGZhbHNlLFxuICAgIHRocm90dGxlRGVsYXkgPSAxMDAwLFxuICAgIGxhc3RFdmVudCA9IFwiXCIsXG4gICAgcmVmcmVzaERhdGUgPSAwLFxuICAgIHRva2VuID0gXCJcIjtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiByZWZyZXNoVG9rZW4oY2IpIHtcbiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICBpZiAobmV3IERhdGUoKSAtIHJlZnJlc2hEYXRlIDwgMzU4MDAwMCkge1xuICAgICAgcmV0dXJuIGNiKHt9KTtcbiAgICB9XG5cbiAgICB4aHIub3BlbihcIlBPU1RcIiwgUkVGUkVTSF9VUkwsIHRydWUpO1xuICAgIHhoci5vbmxvYWRlbmQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByZXNwID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2UpO1xuXG4gICAgICBjYih7IHRva2VuOiByZXNwLmFjY2Vzc190b2tlbiwgcmVmcmVzaGVkQXQ6IG5ldyBEYXRlKCkgfSk7XG4gICAgfTtcblxuICAgIHhoci5zZW5kKCk7XG4gIH1cblxuICBmdW5jdGlvbiBpc1Rocm90dGxlZChldmVudCkge1xuICAgIHJldHVybiB0aHJvdHRsZSAmJiAobGFzdEV2ZW50ID09PSBldmVudCk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGxvZyh0YWJsZU5hbWUsIHBhcmFtcykge1xuICAgIGlmICghdGFibGVOYW1lIHx8ICFwYXJhbXMgfHwgKHBhcmFtcy5oYXNPd25Qcm9wZXJ0eShcImV2ZW50XCIpICYmICFwYXJhbXMuZXZlbnQpIHx8XG4gICAgICAocGFyYW1zLmhhc093blByb3BlcnR5KFwiZXZlbnRcIikgJiYgaXNUaHJvdHRsZWQocGFyYW1zLmV2ZW50KSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aHJvdHRsZSA9IHRydWU7XG4gICAgbGFzdEV2ZW50ID0gcGFyYW1zLmV2ZW50O1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICB0aHJvdHRsZSA9IGZhbHNlO1xuICAgIH0sIHRocm90dGxlRGVsYXkpO1xuXG4gICAgZnVuY3Rpb24gaW5zZXJ0V2l0aFRva2VuKHJlZnJlc2hEYXRhKSB7XG4gICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXG4gICAgICAgIGluc2VydERhdGEsIHVybDtcblxuICAgICAgdXJsID0gc2VydmljZVVybC5yZXBsYWNlKFwiVEFCTEVfSURcIiwgdXRpbHMuZ2V0VGFibGUodGFibGVOYW1lKSk7XG4gICAgICByZWZyZXNoRGF0ZSA9IHJlZnJlc2hEYXRhLnJlZnJlc2hlZEF0IHx8IHJlZnJlc2hEYXRlO1xuICAgICAgdG9rZW4gPSByZWZyZXNoRGF0YS50b2tlbiB8fCB0b2tlbjtcbiAgICAgIGluc2VydERhdGEgPSB1dGlscy5nZXRJbnNlcnREYXRhKHBhcmFtcyk7XG5cbiAgICAgIC8vIEluc2VydCB0aGUgZGF0YS5cbiAgICAgIHhoci5vcGVuKFwiUE9TVFwiLCB1cmwsIHRydWUpO1xuICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJBdXRob3JpemF0aW9uXCIsIFwiQmVhcmVyIFwiICsgdG9rZW4pO1xuXG4gICAgICBpZiAocGFyYW1zLmNiICYmIHR5cGVvZiBwYXJhbXMuY2IgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICB4aHIub25sb2FkZW5kID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcGFyYW1zLmNiKHhoci5yZXNwb25zZSk7XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGluc2VydERhdGEpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVmcmVzaFRva2VuKGluc2VydFdpdGhUb2tlbik7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwibG9nXCI6IGxvZ1xuICB9O1xufSkoUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyVXRpbHMpO1xuXG4vKiBnbG9iYWwgY29uZmlnICovXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkltYWdlID0gUmlzZVZpc2lvbi5JbWFnZSB8fCB7fTtcblxuUmlzZVZpc2lvbi5JbWFnZS5TdG9yYWdlID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwicmlzZS1zdG9yYWdlXCIpLFxuICAgICAgaW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbWFnZVwiKSxcbiAgICAgIHRhYmxlID0gUmlzZVZpc2lvbi5JbWFnZS5nZXRUYWJsZU5hbWUoKSxcbiAgICAgIHVybCA9IFwiXCI7XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLnVybCkge1xuICAgICAgICAvLyBFc2NhcGUgc2luZ2xlIHF1b3Rlcy5cbiAgICAgICAgdXJsID0gZS5kZXRhaWwudXJsLnJlcGxhY2UoXCInXCIsIFwiXFxcXCdcIik7XG4gICAgICAgIGltZy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybCgnXCIgKyB1cmwgKyBcIicpXCI7XG5cbiAgICAgICAgUmlzZVZpc2lvbi5JbWFnZS5zdG9yYWdlRmlsZVVwZGF0ZSh1cmwpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLW5vLWZpbGVcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgXCJldmVudFwiOiBcImVycm9yXCIsXG4gICAgICAgIFwiZXZlbnRfZGV0YWlsc1wiOiBcInN0b3JhZ2UgZmlsZSBub3QgZm91bmRcIixcbiAgICAgICAgXCJmaWxlX3VybFwiOiBlLmRldGFpbFxuICAgICAgfTtcblxuICAgICAgLy8gY2xlYXIgdGhlIGV4aXN0aW5nIGltYWdlXG4gICAgICBpbWcuc3R5bGUuYmFja2dyb3VuZCA9IFwiXCI7XG5cbiAgICAgIFJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlclV0aWxzLmxvZ0V2ZW50KHRhYmxlLCBwYXJhbXMpO1xuICAgICAgUmlzZVZpc2lvbi5JbWFnZS5ub1N0b3JhZ2VGaWxlKCk7XG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtZmlsZS10aHJvdHRsZWRcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgXCJldmVudFwiOiBcImVycm9yXCIsXG4gICAgICAgIFwiZXZlbnRfZGV0YWlsc1wiOiBcInN0b3JhZ2UgZmlsZSB0aHJvdHRsZWRcIixcbiAgICAgICAgXCJmaWxlX3VybFwiOiBlLmRldGFpbFxuICAgICAgfTtcblxuICAgICAgUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyVXRpbHMubG9nRXZlbnQodGFibGUsIHBhcmFtcyk7XG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtZXJyb3JcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIGZpbGVVcmwgPSAoZS5kZXRhaWwgJiYgZS5kZXRhaWwucmVxdWVzdCAmJiBlLmRldGFpbC5yZXF1ZXN0LnVybCkgPyBlLmRldGFpbC5yZXF1ZXN0LnVybCA6IG51bGwsXG4gICAgICAgIHBhcmFtcyA9IHtcbiAgICAgICAgICBcImV2ZW50XCI6IFwiZXJyb3JcIixcbiAgICAgICAgICBcImV2ZW50X2RldGFpbHNcIjogXCJzdG9yYWdlIGVycm9yXCIsXG4gICAgICAgICAgXCJmaWxlX3VybFwiOiBmaWxlVXJsXG4gICAgICAgIH07XG5cbiAgICAgIFJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlclV0aWxzLmxvZ0V2ZW50KHRhYmxlLCBwYXJhbXMpO1xuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1jYWNoZS1lcnJvclwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgZmlsZVVybCA9IChlLmRldGFpbCAmJiBlLmRldGFpbC5yZXF1ZXN0ICYmIGUuZGV0YWlsLnJlcXVlc3QudXJsKSA/IGUuZGV0YWlsLnJlcXVlc3QudXJsIDogbnVsbCxcbiAgICAgICAgcGFyYW1zID0ge1xuICAgICAgICAgIFwiZXZlbnRcIjogXCJlcnJvclwiLFxuICAgICAgICAgIFwiZXZlbnRfZGV0YWlsc1wiOiBcImNhY2hlIGVycm9yXCIsXG4gICAgICAgICAgXCJmaWxlX3VybFwiOiBmaWxlVXJsXG4gICAgICAgIH07XG5cbiAgICAgIFJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlclV0aWxzLmxvZ0V2ZW50KHRhYmxlLCBwYXJhbXMpO1xuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgcGFyYW1zLnN0b3JhZ2UuZm9sZGVyKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZpbGVOYW1lXCIsIHBhcmFtcy5zdG9yYWdlLmZpbGVOYW1lKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBwYXJhbXMuc3RvcmFnZS5jb21wYW55SWQpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZW52XCIsIGNvbmZpZy5TVE9SQUdFX0VOVik7XG4gICAgc3RvcmFnZS5nbygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxuLyogZ2xvYmFsIFJpc2VWaXNpb24sIGdhZGdldHMgKi9cbihmdW5jdGlvbiAod2luZG93LCBkb2N1bWVudCwgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgaWQgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLmdldFN0cmluZyhcImlkXCIpO1xuXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBkb2N1bWVudC5ib2R5Lm9ubW91c2Vkb3duID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIGZ1bmN0aW9uKCkge1xuICAgIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wbGF5X1wiICsgaWQsIHBsYXkpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBSaXNlVmlzaW9uLkltYWdlLmdldEFkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJhZGRpdGlvbmFsUGFyYW1zXCJdKTtcbiAgICB9XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5JbWFnZS5wbGF5KCk7XG4gIH1cbn0pKHdpbmRvdywgZG9jdW1lbnQsIGdhZGdldHMpO1xuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTMnXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
