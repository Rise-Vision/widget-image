if("undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json"),"undefined"==typeof config)var config={STORAGE_ENV:"prod"};var RiseVision=RiseVision||{};RiseVision.Image={},RiseVision.Image=function(e){"use strict";function t(){var e,t=null;c.className=m.position,c.className=m.scaleToFit?c.className+" scale-to-fit":c.className,document.body.style.background=m.background.color,0===Object.keys(m.storage).length?(e=m.url.split("?"),p=1===e.length?"?":"&",s(),r()):(d=new RiseVision.Common.Message(document.getElementById("container"),document.getElementById("messageContainer")),d.show("Please wait while your image is downloaded."),t=new RiseVision.Image.Storage(m),t.init(),r())}function n(){d.show("The selected image does not exist.")}function i(){setTimeout(function(){s()},v)}function s(){f=m.url+p+"cb="+(new Date).getTime(),c.style.backgroundImage="url("+f+")",i()}function o(e,n){Array.isArray(e)&&e.length>0&&"additionalParams"===e[0]&&Array.isArray(n)&&n.length>0&&(m=JSON.parse(n[0]),document.getElementById("container").style.height=g.getInt("rsH")+"px",t())}function r(){e.rpc.call("","rsevent_ready",null,g.getString("id"),!0,!1,!1,!0,!1)}function a(){RiseVision.Common.LoggerUtils.logEvent(u(),{event:"play",file_url:f})}function l(e){f=e,d.hide()}function u(){return"image_events"}var g=new e.Prefs,c=document.getElementById("image"),d=null,m=null,f=null,p="?",v=3e5;return{getAdditionalParams:o,getTableName:u,noStorageFile:n,play:a,storageFileUpdate:l}}(gadgets);var WIDGET_COMMON_CONFIG={AUTH_PATH_URL:"v1/widget/auth",LOGGER_CLIENT_ID:"1088527147109-6q1o2vtihn34292pjt4ckhmhck0rk0o7.apps.googleusercontent.com",LOGGER_CLIENT_SECRET:"nlZyrcPLg6oEwO9f9Wfn29Wh",LOGGER_REFRESH_TOKEN:"1/xzt4kwzE1H7W9VnKB8cAaCx6zb4Es4nKEoqaYHdTD15IgOrJDtdun6zK6XiATCKT",STORAGE_ENV:"prod",STORE_URL:"https://store-dot-rvaserver2.appspot.com/"},RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,t){"use strict";function n(){try{t.style.height=e.style.height}catch(n){console.warn("Can't initialize Message - ",n.message)}}function i(){if(o){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none",e.style.visibility="visible",o=!1}}function s(n){var i,s=document.createDocumentFragment();o?(i=t.querySelector(".message"),i.innerHTML=n):(e.style.visibility="hidden",t.style.display="block",i=document.createElement("p"),i.innerHTML=n,i.setAttribute("class","message"),s.appendChild(i),t.appendChild(s),o=!0)}var o=!1;return n(),{hide:i,show:s}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(e){"use strict";function t(e,t){Array.isArray(e)&&e.length>0&&Array.isArray(t)&&t.length>0&&("companyId"===e[0]&&(g=t[0]),"displayId"===e[1]&&(u=t[1]?t[1]:"preview"),c(g,u))}function n(e,t){var n=null;e.event?(n={},n.event=e.event,e.event_details&&(n.event_details=e.event_details),e.file_url&&(n.file_url=e.file_url,n.file_format=s(e.file_url)),i(function(e,i){n.company_id=e,n.display_id=i,t(n)})):t(n)}function i(n){n&&"function"==typeof n&&(c=n,g&&u?c(g,u):l&&""!==l&&(e.rpc.register("rsparam_set_"+l,t),e.rpc.call("","rsparam_get",null,l,["companyId","displayId"])))}function s(e){var t,n=/[?#&]/;return e&&"string"==typeof e?(t=e.substr(e.lastIndexOf(".")+1),n.test(t)&&(t=t.substr(0,-1!==t.indexOf("?")?t.indexOf("?"):t.length),t=t.substr(0,-1!==t.indexOf("#")?t.indexOf("#"):t.length),t=t.substr(0,-1!==t.indexOf("&")?t.indexOf("&"):t.length)),t.toLowerCase()):null}function o(e){var t=JSON.parse(JSON.stringify(d));return t.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),t.rows[0].json=JSON.parse(JSON.stringify(e)),t.rows[0].json.ts=(new Date).toISOString(),t}function r(e){var t=new Date,n=t.getUTCFullYear(),i=t.getUTCMonth()+1,s=t.getUTCDate();return 10>i&&(i="0"+i),10>s&&(s="0"+s),e+n+i+s}function a(e,t){n(t,function(t){null!==t&&RiseVision.Common.Logger.log(e,t)})}var l=(new e.Prefs).getString("id"),u="",g="",c=null,d={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,rows:[{insertId:""}]};return{getIds:i,getInsertData:o,getFileFormat:s,getTable:r,logEvent:a}}(gadgets),RiseVision.Common.Logger=function(e){"use strict";function t(e){var t=new XMLHttpRequest;return new Date-u<358e4?e({}):(t.open("POST",s,!0),t.onloadend=function(){var n=JSON.parse(t.response);e({token:n.access_token,refreshedAt:new Date})},t.send(),void 0)}function n(e){return r&&l===e}function i(i,s){function c(t){var n,r,a=new XMLHttpRequest;r=o.replace("TABLE_ID",e.getTable(i)),u=t.refreshedAt||u,g=t.token||g,n=e.getInsertData(s),a.open("POST",r,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+g),s.cb&&"function"==typeof s.cb&&(a.onloadend=function(){s.cb(a.response)}),a.send(JSON.stringify(n))}if(!(!i||!s||s.hasOwnProperty("event")&&!s.event||s.hasOwnProperty("event")&&n(s.event)))return r=!0,l=s.event,setTimeout(function(){r=!1},a),t(c)}var s="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",o="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",r=!1,a=1e3,l="",u=0,g="";return{log:i}}(RiseVision.Common.LoggerUtils);var RiseVision=RiseVision||{};RiseVision.Image=RiseVision.Image||{},RiseVision.Image.Storage=function(e){"use strict";function t(){var t=document.querySelector("rise-storage"),n=document.getElementById("image"),i=RiseVision.Image.getTableName(),s="";t.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.url&&(s=e.detail.url.replace("'","\\'"),n.style.backgroundImage="url('"+s+"')",RiseVision.Image.storageFileUpdate(s))}),t.addEventListener("rise-storage-no-file",function(e){var t={event:"error",event_details:"storage file not found",file_url:e.detail};n.style.background="",RiseVision.Common.LoggerUtils.logEvent(i,t),RiseVision.Image.noStorageFile()}),t.addEventListener("rise-storage-file-throttled",function(e){var t={event:"error",event_details:"storage file throttled",file_url:e.detail};RiseVision.Common.LoggerUtils.logEvent(i,t)}),t.addEventListener("rise-storage-error",function(e){var t=e.detail&&e.detail.request&&e.detail.request.url?e.detail.request.url:null,n={event:"error",event_details:"storage error",file_url:t};RiseVision.Common.LoggerUtils.logEvent(i,n)}),t.addEventListener("rise-cache-error",function(e){var t=e.detail&&e.detail.request&&e.detail.request.url?e.detail.request.url:null,n={event:"error",event_details:"cache error",file_url:t};RiseVision.Common.LoggerUtils.logEvent(i,n)}),t.setAttribute("folder",e.storage.folder),t.setAttribute("fileName",e.storage.fileName),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("env",config.STORAGE_ENV),t.go()}return{init:t}},function(e,t,n){"use strict";function i(){RiseVision.Image.play()}var s=(new n.Prefs).getString("id");e.oncontextmenu=function(){return!1},t.body.onmousedown=function(){return!1},e.addEventListener("WebComponentsReady",function(){s&&""!==s&&(n.rpc.register("rscmd_play_"+s,i),n.rpc.register("rsparam_set_"+s,RiseVision.Image.getAdditionalParams),n.rpc.call("","rsparam_get",null,s,["additionalParams"]))})}(window,document,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-3"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiY29uZmlnIiwiU1RPUkFHRV9FTlYiLCJSaXNlVmlzaW9uIiwiSW1hZ2UiLCJnYWRnZXRzIiwiaW5pdCIsInN0ciIsInN0b3JhZ2UiLCJpbWciLCJjbGFzc05hbWUiLCJwYXJhbXMiLCJwb3NpdGlvbiIsInNjYWxlVG9GaXQiLCJkb2N1bWVudCIsImJvZHkiLCJzdHlsZSIsImJhY2tncm91bmQiLCJjb2xvciIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJ1cmwiLCJzcGxpdCIsInNlcGFyYXRvciIsInNldEJhY2tncm91bmRJbWFnZSIsInJlYWR5IiwibWVzc2FnZSIsIkNvbW1vbiIsIk1lc3NhZ2UiLCJnZXRFbGVtZW50QnlJZCIsInNob3ciLCJTdG9yYWdlIiwibm9TdG9yYWdlRmlsZSIsInN0YXJ0VGltZXIiLCJzZXRUaW1lb3V0IiwicmVmcmVzaEludGVydmFsIiwiZmlsZVVybCIsIkRhdGUiLCJnZXRUaW1lIiwiYmFja2dyb3VuZEltYWdlIiwiZ2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwiSlNPTiIsInBhcnNlIiwiaGVpZ2h0IiwicHJlZnMiLCJnZXRJbnQiLCJycGMiLCJjYWxsIiwiZ2V0U3RyaW5nIiwicGxheSIsIkxvZ2dlclV0aWxzIiwibG9nRXZlbnQiLCJnZXRUYWJsZU5hbWUiLCJldmVudCIsImZpbGVfdXJsIiwic3RvcmFnZUZpbGVVcGRhdGUiLCJoaWRlIiwiUHJlZnMiLCJXSURHRVRfQ09NTU9OX0NPTkZJRyIsIkFVVEhfUEFUSF9VUkwiLCJMT0dHRVJfQ0xJRU5UX0lEIiwiTE9HR0VSX0NMSUVOVF9TRUNSRVQiLCJMT0dHRVJfUkVGUkVTSF9UT0tFTiIsIlNUT1JFX1VSTCIsIm1haW5Db250YWluZXIiLCJtZXNzYWdlQ29udGFpbmVyIiwiX2luaXQiLCJlIiwiY29uc29sZSIsIndhcm4iLCJfYWN0aXZlIiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwiZGlzcGxheSIsInZpc2liaWxpdHkiLCJwIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJhcHBlbmRDaGlsZCIsInNldElkcyIsImNvbXBhbnlJZCIsImRpc3BsYXlJZCIsImNhbGxiYWNrIiwiZ2V0RXZlbnRQYXJhbXMiLCJjYiIsImpzb24iLCJldmVudF9kZXRhaWxzIiwiZmlsZV9mb3JtYXQiLCJnZXRGaWxlRm9ybWF0IiwiZ2V0SWRzIiwiY29tcGFueV9pZCIsImRpc3BsYXlfaWQiLCJpZCIsInJlZ2lzdGVyIiwiaGFzUGFyYW1zIiwic3Vic3RyIiwibGFzdEluZGV4T2YiLCJ0ZXN0IiwiaW5kZXhPZiIsInRvTG93ZXJDYXNlIiwiZ2V0SW5zZXJ0RGF0YSIsImRhdGEiLCJzdHJpbmdpZnkiLCJCQVNFX0lOU0VSVF9TQ0hFTUEiLCJyb3dzIiwiaW5zZXJ0SWQiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJ0b1VwcGVyQ2FzZSIsInRzIiwidG9JU09TdHJpbmciLCJnZXRUYWJsZSIsIm5hbWUiLCJkYXRlIiwieWVhciIsImdldFVUQ0Z1bGxZZWFyIiwibW9udGgiLCJnZXRVVENNb250aCIsImRheSIsImdldFVUQ0RhdGUiLCJ0YWJsZSIsIkxvZ2dlciIsImxvZyIsImtpbmQiLCJza2lwSW52YWxpZFJvd3MiLCJpZ25vcmVVbmtub3duVmFsdWVzIiwidXRpbHMiLCJyZWZyZXNoVG9rZW4iLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsInJlZnJlc2hEYXRlIiwib3BlbiIsIlJFRlJFU0hfVVJMIiwib25sb2FkZW5kIiwicmVzcCIsInJlc3BvbnNlIiwidG9rZW4iLCJhY2Nlc3NfdG9rZW4iLCJyZWZyZXNoZWRBdCIsInNlbmQiLCJpc1Rocm90dGxlZCIsInRocm90dGxlIiwibGFzdEV2ZW50IiwidGFibGVOYW1lIiwiaW5zZXJ0V2l0aFRva2VuIiwicmVmcmVzaERhdGEiLCJpbnNlcnREYXRhIiwic2VydmljZVVybCIsInJlcGxhY2UiLCJzZXRSZXF1ZXN0SGVhZGVyIiwiaGFzT3duUHJvcGVydHkiLCJ0aHJvdHRsZURlbGF5IiwiYWRkRXZlbnRMaXN0ZW5lciIsImRldGFpbCIsInJlcXVlc3QiLCJmb2xkZXIiLCJmaWxlTmFtZSIsImdvIiwid2luZG93Iiwib25jb250ZXh0bWVudSIsIm9ubW91c2Vkb3duIiwiX2dhcSIsInB1c2giLCJnYSIsInR5cGUiLCJhc3luYyIsInNyYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIl0sIm1hcHBpbmdzIjoiQUFRQSxHQU51QixtQkFBWkEsVUFDVEEsUUFBUUMsT0FBTyxvQ0FDWkMsU0FBUyxpQkFBa0Isd0JBQzNCQSxTQUFTLGdCQUFpQixTQUdULG1CQUFYQyxRQUNULEdBQUlBLFNBQ0ZDLFlBQWEsT0FNakIsSUFBSUMsWUFBYUEsY0FDakJBLFlBQVdDLFNBRVhELFdBQVdDLE1BQVEsU0FBV0MsR0FDNUIsWUFhQSxTQUFTQyxLQUNQLEdBQ0VDLEdBREVDLEVBQVUsSUFHZEMsR0FBSUMsVUFBWUMsRUFBT0MsU0FDdkJILEVBQUlDLFVBQVlDLEVBQU9FLFdBQWFKLEVBQUlDLFVBQVksZ0JBQWtCRCxFQUFJQyxVQUMxRUksU0FBU0MsS0FBS0MsTUFBTUMsV0FBYU4sRUFBT00sV0FBV0MsTUFHUixJQUF2Q0MsT0FBT0MsS0FBS1QsRUFBT0gsU0FBU2EsUUFDOUJkLEVBQU1JLEVBQU9XLElBQUlDLE1BQU0sS0FHckJDLEVBRGlCLElBQWZqQixFQUFJYyxPQUNNLElBR0EsSUFHZEksSUFDQUMsTUFLQUMsRUFBVSxHQUFJeEIsWUFBV3lCLE9BQU9DLFFBQVFmLFNBQVNnQixlQUFlLGFBQzlEaEIsU0FBU2dCLGVBQWUscUJBRzFCSCxFQUFRSSxLQUFLLCtDQUVi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U0FBUyxlQUFpQkQsRUFBSWxHLFdBQVdDLE1BQU1xQyxxQkFDM0RwQyxFQUFROEMsSUFBSUMsS0FBSyxHQUFJLGNBQWUsS0FBTWlELEdBQUsseUJBT2xEbUUsT0FBUTFKLFNBQVVULFFBR3JCLElBQUlzSyxNQUFPQSxRQUVYQSxNQUFLQyxNQUFNLGNBQWUsa0JBQzFCRCxLQUFLQyxNQUFNLG1CQUVYLFdBQ0UsR0FBSUMsR0FBSy9KLFNBQVN1RSxjQUFjLFNBQVd3RixHQUFHQyxLQUFPLGtCQUFtQkQsRUFBR0UsT0FBUSxFQUNuRkYsRUFBR0csS0FBTyxVQUFZbEssU0FBU21LLFNBQVNDLFNBQVcsY0FBZ0IsY0FBZ0IsNkJBQ25GLElBQUlDLEdBQUlySyxTQUFTc0sscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVQsRUFBSU0iLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgLmNvbnN0YW50KFwiTE9DQUxFU19QUkVGSVhcIiwgXCJsb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgIC5jb25zdGFudChcIkxPQ0FMRVNfU1VGSVhcIiwgXCIuanNvblwiKTtcbn1cblxuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICBTVE9SQUdFX0VOVjogXCJwcm9kXCJcbiAgfTtcbn1cblxuLyogZ2xvYmFsIGdhZGdldHMgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5JbWFnZSA9IHt9O1xuXG5SaXNlVmlzaW9uLkltYWdlID0gKGZ1bmN0aW9uIChnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbWFnZVwiKSxcbiAgICBtZXNzYWdlID0gbnVsbCxcbiAgICBwYXJhbXMgPSBudWxsLFxuICAgIGZpbGVVcmwgPSBudWxsLFxuICAgIHNlcGFyYXRvciA9IFwiP1wiLFxuICAgIHJlZnJlc2hJbnRlcnZhbCA9IDMwMDAwMDsgIC8vIDUgbWludXRlc1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBudWxsLFxuICAgICAgc3RyO1xuXG4gICAgaW1nLmNsYXNzTmFtZSA9IHBhcmFtcy5wb3NpdGlvbjtcbiAgICBpbWcuY2xhc3NOYW1lID0gcGFyYW1zLnNjYWxlVG9GaXQgPyBpbWcuY2xhc3NOYW1lICsgXCIgc2NhbGUtdG8tZml0XCIgOiBpbWcuY2xhc3NOYW1lO1xuICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuYmFja2dyb3VuZCA9IHBhcmFtcy5iYWNrZ3JvdW5kLmNvbG9yO1xuXG4gICAgLy8gVGhpcmQgcGFydHkgVVJMXG4gICAgaWYgKE9iamVjdC5rZXlzKHBhcmFtcy5zdG9yYWdlKS5sZW5ndGggPT09IDApIHtcbiAgICAgIHN0ciA9IHBhcmFtcy51cmwuc3BsaXQoXCI/XCIpO1xuXG4gICAgICBpZiAoc3RyLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBzZXBhcmF0b3IgPSBcIj9cIjtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBzZXBhcmF0b3IgPSBcIiZcIjtcbiAgICAgIH1cblxuICAgICAgc2V0QmFja2dyb3VuZEltYWdlKCk7XG4gICAgICByZWFkeSgpO1xuICAgIH1cbiAgICAvLyBSaXNlIFN0b3JhZ2VcbiAgICBlbHNlIHtcbiAgICAgIC8vIGNyZWF0ZSBpbnN0YW5jZSBvZiBtZXNzYWdlXG4gICAgICBtZXNzYWdlID0gbmV3IFJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb250YWluZXJcIiksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWVzc2FnZUNvbnRhaW5lclwiKSk7XG5cbiAgICAgIC8vIHNob3cgd2FpdCBtZXNzYWdlIHdoaWxlIFN0b3JhZ2UgaW5pdGlhbGl6ZXNcbiAgICAgIG1lc3NhZ2Uuc2hvdyhcIlBsZWFzZSB3YWl0IHdoaWxlIHlvdXIgaW1hZ2UgaXMgZG93bmxvYWRlZC5cIik7XG5cbiAgICAgIHN0b3JhZ2UgPSBuZXcgUmlzZVZpc2lvbi5JbWFnZS5TdG9yYWdlKHBhcmFtcyk7XG4gICAgICBzdG9yYWdlLmluaXQoKTtcblxuICAgICAgcmVhZHkoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBub1N0b3JhZ2VGaWxlKCkge1xuICAgIG1lc3NhZ2Uuc2hvdyhcIlRoZSBzZWxlY3RlZCBpbWFnZSBkb2VzIG5vdCBleGlzdC5cIik7XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydFRpbWVyKCkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBzZXRCYWNrZ3JvdW5kSW1hZ2UoKTtcbiAgICB9LCByZWZyZXNoSW50ZXJ2YWwpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0QmFja2dyb3VuZEltYWdlKCkge1xuICAgIGZpbGVVcmwgPSBwYXJhbXMudXJsICsgc2VwYXJhdG9yICsgXCJjYj1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIGltZy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGZpbGVVcmwgKyBcIilcIjtcblxuICAgIHN0YXJ0VGltZXIoKTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gZ2V0QWRkaXRpb25hbFBhcmFtcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgbmFtZXNbMF0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHBhcmFtcyA9IEpTT04ucGFyc2UodmFsdWVzWzBdKTtcblxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBwcmVmcy5nZXRJbnQoXCJyc0hcIikgKyBcInB4XCI7XG4gICAgICAgIGluaXQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiByZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSwgdHJ1ZSxcbiAgICAgIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscy5sb2dFdmVudChnZXRUYWJsZU5hbWUoKSwgeyBcImV2ZW50XCI6IFwicGxheVwiLCBcImZpbGVfdXJsXCI6IGZpbGVVcmwgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9yYWdlRmlsZVVwZGF0ZSh1cmwpIHtcbiAgICBmaWxlVXJsID0gdXJsO1xuXG4gICAgLy8gcmVtb3ZlIGEgbWVzc2FnZSBwcmV2aW91c2x5IHNob3duXG4gICAgbWVzc2FnZS5oaWRlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRUYWJsZU5hbWUoKSB7XG4gICAgcmV0dXJuIFwiaW1hZ2VfZXZlbnRzXCI7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiZ2V0QWRkaXRpb25hbFBhcmFtc1wiOiBnZXRBZGRpdGlvbmFsUGFyYW1zLFxuICAgIFwiZ2V0VGFibGVOYW1lXCI6IGdldFRhYmxlTmFtZSxcbiAgICBcIm5vU3RvcmFnZUZpbGVcIjogbm9TdG9yYWdlRmlsZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInN0b3JhZ2VGaWxlVXBkYXRlXCI6IHN0b3JhZ2VGaWxlVXBkYXRlXG4gIH07XG59KShnYWRnZXRzKTtcblxudmFyIFdJREdFVF9DT01NT05fQ09ORklHID0ge1xuICBBVVRIX1BBVEhfVVJMOiBcInYxL3dpZGdldC9hdXRoXCIsXG4gIExPR0dFUl9DTElFTlRfSUQ6IFwiMTA4ODUyNzE0NzEwOS02cTFvMnZ0aWhuMzQyOTJwanQ0Y2tobWhjazByazBvNy5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbVwiLFxuICBMT0dHRVJfQ0xJRU5UX1NFQ1JFVDogXCJubFp5cmNQTGc2b0V3TzlmOVdmbjI5V2hcIixcbiAgTE9HR0VSX1JFRlJFU0hfVE9LRU46IFwiMS94enQ0a3d6RTFIN1c5Vm5LQjhjQWFDeDZ6YjRFczRuS0VvcWFZSGRURDE1SWdPckpEdGR1bjZ6SzZYaUFUQ0tUXCIsXG4gIFNUT1JBR0VfRU5WOiBcInByb2RcIixcbiAgU1RPUkVfVVJMOiBcImh0dHBzOi8vc3RvcmUtZG90LXJ2YXNlcnZlcjIuYXBwc3BvdC5jb20vXCJcbn07XG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5NZXNzYWdlID0gZnVuY3Rpb24gKG1haW5Db250YWluZXIsIG1lc3NhZ2VDb250YWluZXIpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9hY3RpdmUgPSBmYWxzZTtcblxuICBmdW5jdGlvbiBfaW5pdCgpIHtcbiAgICB0cnkge1xuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBtYWluQ29udGFpbmVyLnN0eWxlLmhlaWdodDtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJDYW4ndCBpbml0aWFsaXplIE1lc3NhZ2UgLSBcIiwgZS5tZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKF9hY3RpdmUpIHtcbiAgICAgIC8vIGNsZWFyIGNvbnRlbnQgb2YgbWVzc2FnZSBjb250YWluZXJcbiAgICAgIHdoaWxlIChtZXNzYWdlQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgbWVzc2FnZUNvbnRhaW5lci5yZW1vdmVDaGlsZChtZXNzYWdlQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xuICAgICAgfVxuXG4gICAgICAvLyBoaWRlIG1lc3NhZ2UgY29udGFpbmVyXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgICAgLy8gc2hvdyBtYWluIGNvbnRhaW5lclxuICAgICAgbWFpbkNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG5cbiAgICAgIF9hY3RpdmUgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzaG93KG1lc3NhZ2UpIHtcbiAgICB2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksXG4gICAgICBwO1xuXG4gICAgaWYgKCFfYWN0aXZlKSB7XG4gICAgICAvLyBoaWRlIG1haW4gY29udGFpbmVyXG4gICAgICBtYWluQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG5cbiAgICAgIC8vIGNyZWF0ZSBtZXNzYWdlIGVsZW1lbnRcbiAgICAgIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICAgIHAuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICAgIHAuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJtZXNzYWdlXCIpO1xuXG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChwKTtcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuXG4gICAgICBfYWN0aXZlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gbWVzc2FnZSBhbHJlYWR5IGJlaW5nIHNob3duLCB1cGRhdGUgbWVzc2FnZSB0ZXh0XG4gICAgICBwID0gbWVzc2FnZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLm1lc3NhZ2VcIik7XG4gICAgICBwLmlubmVySFRNTCA9IG1lc3NhZ2U7XG4gICAgfVxuICB9XG5cbiAgX2luaXQoKTtcblxuICByZXR1cm4ge1xuICAgIFwiaGlkZVwiOiBoaWRlLFxuICAgIFwic2hvd1wiOiBzaG93XG4gIH07XG59O1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscyA9IChmdW5jdGlvbihnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gICB2YXIgaWQgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLmdldFN0cmluZyhcImlkXCIpLFxuICAgIGRpc3BsYXlJZCA9IFwiXCIsXG4gICAgY29tcGFueUlkID0gXCJcIixcbiAgICBjYWxsYmFjayA9IG51bGw7XG5cbiAgdmFyIEJBU0VfSU5TRVJUX1NDSEVNQSA9XG4gIHtcbiAgICBcImtpbmRcIjogXCJiaWdxdWVyeSN0YWJsZURhdGFJbnNlcnRBbGxSZXF1ZXN0XCIsXG4gICAgXCJza2lwSW52YWxpZFJvd3NcIjogZmFsc2UsXG4gICAgXCJpZ25vcmVVbmtub3duVmFsdWVzXCI6IGZhbHNlLFxuICAgIFwicm93c1wiOiBbe1xuICAgICAgXCJpbnNlcnRJZFwiOiBcIlwiXG4gICAgfV1cbiAgfTtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuXG4gIC8qIFNldCB0aGUgQ29tcGFueSBhbmQgRGlzcGxheSBJRHMuICovXG4gIGZ1bmN0aW9uIHNldElkcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKG5hbWVzWzBdID09PSBcImNvbXBhbnlJZFwiKSB7XG4gICAgICAgICAgY29tcGFueUlkID0gdmFsdWVzWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5hbWVzWzFdID09PSBcImRpc3BsYXlJZFwiKSB7XG4gICAgICAgICAgaWYgKHZhbHVlc1sxXSkge1xuICAgICAgICAgICAgZGlzcGxheUlkID0gdmFsdWVzWzFdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRpc3BsYXlJZCA9IFwicHJldmlld1wiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNhbGxiYWNrKGNvbXBhbnlJZCwgZGlzcGxheUlkKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKiBSZXRyaWV2ZSBwYXJhbWV0ZXJzIHRvIHBhc3MgdG8gdGhlIGV2ZW50IGxvZ2dlci4gKi9cbiAgZnVuY3Rpb24gZ2V0RXZlbnRQYXJhbXMocGFyYW1zLCBjYikge1xuICAgIHZhciBqc29uID0gbnVsbDtcblxuICAgIC8vIGV2ZW50IGlzIHJlcXVpcmVkLlxuICAgIGlmIChwYXJhbXMuZXZlbnQpIHtcbiAgICAgIGpzb24gPSB7fTtcbiAgICAgIGpzb24uZXZlbnQgPSBwYXJhbXMuZXZlbnQ7XG5cbiAgICAgIGlmIChwYXJhbXMuZXZlbnRfZGV0YWlscykge1xuICAgICAgICBqc29uLmV2ZW50X2RldGFpbHMgPSBwYXJhbXMuZXZlbnRfZGV0YWlscztcbiAgICAgIH1cblxuICAgICAgaWYgKHBhcmFtcy5maWxlX3VybCkge1xuICAgICAgICBqc29uLmZpbGVfdXJsID0gcGFyYW1zLmZpbGVfdXJsO1xuICAgICAgICBqc29uLmZpbGVfZm9ybWF0ID0gZ2V0RmlsZUZvcm1hdChwYXJhbXMuZmlsZV91cmwpO1xuICAgICAgfVxuXG4gICAgICBnZXRJZHMoZnVuY3Rpb24oY29tcGFueUlkLCBkaXNwbGF5SWQpIHtcbiAgICAgICAganNvbi5jb21wYW55X2lkID0gY29tcGFueUlkO1xuICAgICAgICBqc29uLmRpc3BsYXlfaWQgPSBkaXNwbGF5SWQ7XG5cbiAgICAgICAgY2IoanNvbik7XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBjYihqc29uKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGdldElkcyhjYikge1xuICAgIGlmICghY2IgfHwgdHlwZW9mIGNiICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBjYWxsYmFjayA9IGNiO1xuICAgIH1cblxuICAgIGlmIChjb21wYW55SWQgJiYgZGlzcGxheUlkKSB7XG4gICAgICBjYWxsYmFjayhjb21wYW55SWQsIGRpc3BsYXlJZCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKGlkICYmIGlkICE9PSBcIlwiKSB7XG4gICAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgc2V0SWRzKTtcbiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJjb21wYW55SWRcIiwgXCJkaXNwbGF5SWRcIl0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEZpbGVGb3JtYXQodXJsKSB7XG4gICAgdmFyIGhhc1BhcmFtcyA9IC9bPyMmXS8sXG4gICAgICBzdHI7XG5cbiAgICBpZiAoIXVybCB8fCB0eXBlb2YgdXJsICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBzdHIgPSB1cmwuc3Vic3RyKHVybC5sYXN0SW5kZXhPZihcIi5cIikgKyAxKTtcblxuICAgIC8vIGRvbid0IGluY2x1ZGUgYW55IHBhcmFtcyBhZnRlciB0aGUgZmlsZW5hbWVcbiAgICBpZiAoaGFzUGFyYW1zLnRlc3Qoc3RyKSkge1xuICAgICAgc3RyID0gc3RyLnN1YnN0cigwICwoc3RyLmluZGV4T2YoXCI/XCIpICE9PSAtMSkgPyBzdHIuaW5kZXhPZihcIj9cIikgOiBzdHIubGVuZ3RoKTtcblxuICAgICAgc3RyID0gc3RyLnN1YnN0cigwLCAoc3RyLmluZGV4T2YoXCIjXCIpICE9PSAtMSkgPyBzdHIuaW5kZXhPZihcIiNcIikgOiBzdHIubGVuZ3RoKTtcblxuICAgICAgc3RyID0gc3RyLnN1YnN0cigwLCAoc3RyLmluZGV4T2YoXCImXCIpICE9PSAtMSkgPyBzdHIuaW5kZXhPZihcIiZcIikgOiBzdHIubGVuZ3RoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RyLnRvTG93ZXJDYXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRJbnNlcnREYXRhKHBhcmFtcykge1xuICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShCQVNFX0lOU0VSVF9TQ0hFTUEpKTtcblxuICAgIGRhdGEucm93c1swXS5pbnNlcnRJZCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyKS50b1VwcGVyQ2FzZSgpO1xuICAgIGRhdGEucm93c1swXS5qc29uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICBkYXRhLnJvd3NbMF0uanNvbi50cyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0VGFibGUobmFtZSkge1xuICAgIHZhciBkYXRlID0gbmV3IERhdGUoKSxcbiAgICAgIHllYXIgPSBkYXRlLmdldFVUQ0Z1bGxZZWFyKCksXG4gICAgICBtb250aCA9IGRhdGUuZ2V0VVRDTW9udGgoKSArIDEsXG4gICAgICBkYXkgPSBkYXRlLmdldFVUQ0RhdGUoKTtcblxuICAgIGlmIChtb250aCA8IDEwKSB7XG4gICAgICBtb250aCA9IFwiMFwiICsgbW9udGg7XG4gICAgfVxuXG4gICAgaWYgKGRheSA8IDEwKSB7XG4gICAgICBkYXkgPSBcIjBcIiArIGRheTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmFtZSArIHllYXIgKyBtb250aCArIGRheTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxvZ0V2ZW50KHRhYmxlLCBwYXJhbXMpIHtcbiAgICBnZXRFdmVudFBhcmFtcyhwYXJhbXMsIGZ1bmN0aW9uKGpzb24pIHtcbiAgICAgIGlmIChqc29uICE9PSBudWxsKSB7XG4gICAgICAgIFJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlci5sb2codGFibGUsIGpzb24pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImdldElkc1wiOiBnZXRJZHMsXG4gICAgXCJnZXRJbnNlcnREYXRhXCI6IGdldEluc2VydERhdGEsXG4gICAgXCJnZXRGaWxlRm9ybWF0XCI6IGdldEZpbGVGb3JtYXQsXG4gICAgXCJnZXRUYWJsZVwiOiBnZXRUYWJsZSxcbiAgICBcImxvZ0V2ZW50XCI6IGxvZ0V2ZW50XG4gIH07XG59KShnYWRnZXRzKTtcblxuUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyID0gKGZ1bmN0aW9uKHV0aWxzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBSRUZSRVNIX1VSTCA9IFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YzL3Rva2VuP2NsaWVudF9pZD1cIiArIFdJREdFVF9DT01NT05fQ09ORklHLkxPR0dFUl9DTElFTlRfSUQgK1xuICAgICAgXCImY2xpZW50X3NlY3JldD1cIiArIFdJREdFVF9DT01NT05fQ09ORklHLkxPR0dFUl9DTElFTlRfU0VDUkVUICtcbiAgICAgIFwiJnJlZnJlc2hfdG9rZW49XCIgKyBXSURHRVRfQ09NTU9OX0NPTkZJRy5MT0dHRVJfUkVGUkVTSF9UT0tFTiArXG4gICAgICBcIiZncmFudF90eXBlPXJlZnJlc2hfdG9rZW5cIjtcblxuICB2YXIgc2VydmljZVVybCA9IFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYmlncXVlcnkvdjIvcHJvamVjdHMvY2xpZW50LXNpZGUtZXZlbnRzL2RhdGFzZXRzL1dpZGdldF9FdmVudHMvdGFibGVzL1RBQkxFX0lEL2luc2VydEFsbFwiLFxuICAgIHRocm90dGxlID0gZmFsc2UsXG4gICAgdGhyb3R0bGVEZWxheSA9IDEwMDAsXG4gICAgbGFzdEV2ZW50ID0gXCJcIixcbiAgICByZWZyZXNoRGF0ZSA9IDAsXG4gICAgdG9rZW4gPSBcIlwiO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIHJlZnJlc2hUb2tlbihjYikge1xuICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgIGlmIChuZXcgRGF0ZSgpIC0gcmVmcmVzaERhdGUgPCAzNTgwMDAwKSB7XG4gICAgICByZXR1cm4gY2Ioe30pO1xuICAgIH1cblxuICAgIHhoci5vcGVuKFwiUE9TVFwiLCBSRUZSRVNIX1VSTCwgdHJ1ZSk7XG4gICAgeGhyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHJlc3AgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZSk7XG5cbiAgICAgIGNiKHsgdG9rZW46IHJlc3AuYWNjZXNzX3Rva2VuLCByZWZyZXNoZWRBdDogbmV3IERhdGUoKSB9KTtcbiAgICB9O1xuXG4gICAgeGhyLnNlbmQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzVGhyb3R0bGVkKGV2ZW50KSB7XG4gICAgcmV0dXJuIHRocm90dGxlICYmIChsYXN0RXZlbnQgPT09IGV2ZW50KTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gbG9nKHRhYmxlTmFtZSwgcGFyYW1zKSB7XG4gICAgaWYgKCF0YWJsZU5hbWUgfHwgIXBhcmFtcyB8fCAocGFyYW1zLmhhc093blByb3BlcnR5KFwiZXZlbnRcIikgJiYgIXBhcmFtcy5ldmVudCkgfHxcbiAgICAgIChwYXJhbXMuaGFzT3duUHJvcGVydHkoXCJldmVudFwiKSAmJiBpc1Rocm90dGxlZChwYXJhbXMuZXZlbnQpKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRocm90dGxlID0gdHJ1ZTtcbiAgICBsYXN0RXZlbnQgPSBwYXJhbXMuZXZlbnQ7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHRocm90dGxlID0gZmFsc2U7XG4gICAgfSwgdGhyb3R0bGVEZWxheSk7XG5cbiAgICBmdW5jdGlvbiBpbnNlcnRXaXRoVG9rZW4ocmVmcmVzaERhdGEpIHtcbiAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKSxcbiAgICAgICAgaW5zZXJ0RGF0YSwgdXJsO1xuXG4gICAgICB1cmwgPSBzZXJ2aWNlVXJsLnJlcGxhY2UoXCJUQUJMRV9JRFwiLCB1dGlscy5nZXRUYWJsZSh0YWJsZU5hbWUpKTtcbiAgICAgIHJlZnJlc2hEYXRlID0gcmVmcmVzaERhdGEucmVmcmVzaGVkQXQgfHwgcmVmcmVzaERhdGU7XG4gICAgICB0b2tlbiA9IHJlZnJlc2hEYXRhLnRva2VuIHx8IHRva2VuO1xuICAgICAgaW5zZXJ0RGF0YSA9IHV0aWxzLmdldEluc2VydERhdGEocGFyYW1zKTtcblxuICAgICAgLy8gSW5zZXJ0IHRoZSBkYXRhLlxuICAgICAgeGhyLm9wZW4oXCJQT1NUXCIsIHVybCwgdHJ1ZSk7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkF1dGhvcml6YXRpb25cIiwgXCJCZWFyZXIgXCIgKyB0b2tlbik7XG5cbiAgICAgIGlmIChwYXJhbXMuY2IgJiYgdHlwZW9mIHBhcmFtcy5jYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHhoci5vbmxvYWRlbmQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBwYXJhbXMuY2IoeGhyLnJlc3BvbnNlKTtcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoaW5zZXJ0RGF0YSkpO1xuICAgIH1cblxuICAgIHJldHVybiByZWZyZXNoVG9rZW4oaW5zZXJ0V2l0aFRva2VuKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJsb2dcIjogbG9nXG4gIH07XG59KShSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscyk7XG5cbi8qIGdsb2JhbCBjb25maWcgKi9cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uSW1hZ2UgPSBSaXNlVmlzaW9uLkltYWdlIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkltYWdlLlN0b3JhZ2UgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgc3RvcmFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJyaXNlLXN0b3JhZ2VcIiksXG4gICAgICBpbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImltYWdlXCIpLFxuICAgICAgdGFibGUgPSBSaXNlVmlzaW9uLkltYWdlLmdldFRhYmxlTmFtZSgpLFxuICAgICAgdXJsID0gXCJcIjtcblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoZS5kZXRhaWwgJiYgZS5kZXRhaWwudXJsKSB7XG4gICAgICAgIC8vIEVzY2FwZSBzaW5nbGUgcXVvdGVzLlxuICAgICAgICB1cmwgPSBlLmRldGFpbC51cmwucmVwbGFjZShcIidcIiwgXCJcXFxcJ1wiKTtcbiAgICAgICAgaW1nLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKCdcIiArIHVybCArIFwiJylcIjtcblxuICAgICAgICBSaXNlVmlzaW9uLkltYWdlLnN0b3JhZ2VGaWxlVXBkYXRlKHVybCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2Utbm8tZmlsZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICBcImV2ZW50XCI6IFwiZXJyb3JcIixcbiAgICAgICAgXCJldmVudF9kZXRhaWxzXCI6IFwic3RvcmFnZSBmaWxlIG5vdCBmb3VuZFwiLFxuICAgICAgICBcImZpbGVfdXJsXCI6IGUuZGV0YWlsXG4gICAgICB9O1xuXG4gICAgICAvLyBjbGVhciB0aGUgZXhpc3RpbmcgaW1hZ2VcbiAgICAgIGltZy5zdHlsZS5iYWNrZ3JvdW5kID0gXCJcIjtcblxuICAgICAgUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyVXRpbHMubG9nRXZlbnQodGFibGUsIHBhcmFtcyk7XG4gICAgICBSaXNlVmlzaW9uLkltYWdlLm5vU3RvcmFnZUZpbGUoKTtcbiAgICB9KTtcblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1maWxlLXRocm90dGxlZFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICBcImV2ZW50XCI6IFwiZXJyb3JcIixcbiAgICAgICAgXCJldmVudF9kZXRhaWxzXCI6IFwic3RvcmFnZSBmaWxlIHRocm90dGxlZFwiLFxuICAgICAgICBcImZpbGVfdXJsXCI6IGUuZGV0YWlsXG4gICAgICB9O1xuXG4gICAgICBSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscy5sb2dFdmVudCh0YWJsZSwgcGFyYW1zKTtcbiAgICB9KTtcblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1lcnJvclwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgZmlsZVVybCA9IChlLmRldGFpbCAmJiBlLmRldGFpbC5yZXF1ZXN0ICYmIGUuZGV0YWlsLnJlcXVlc3QudXJsKSA/IGUuZGV0YWlsLnJlcXVlc3QudXJsIDogbnVsbCxcbiAgICAgICAgcGFyYW1zID0ge1xuICAgICAgICAgIFwiZXZlbnRcIjogXCJlcnJvclwiLFxuICAgICAgICAgIFwiZXZlbnRfZGV0YWlsc1wiOiBcInN0b3JhZ2UgZXJyb3JcIixcbiAgICAgICAgICBcImZpbGVfdXJsXCI6IGZpbGVVcmxcbiAgICAgICAgfTtcblxuICAgICAgUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyVXRpbHMubG9nRXZlbnQodGFibGUsIHBhcmFtcyk7XG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLWNhY2hlLWVycm9yXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciBmaWxlVXJsID0gKGUuZGV0YWlsICYmIGUuZGV0YWlsLnJlcXVlc3QgJiYgZS5kZXRhaWwucmVxdWVzdC51cmwpID8gZS5kZXRhaWwucmVxdWVzdC51cmwgOiBudWxsLFxuICAgICAgICBwYXJhbXMgPSB7XG4gICAgICAgICAgXCJldmVudFwiOiBcImVycm9yXCIsXG4gICAgICAgICAgXCJldmVudF9kZXRhaWxzXCI6IFwiY2FjaGUgZXJyb3JcIixcbiAgICAgICAgICBcImZpbGVfdXJsXCI6IGZpbGVVcmxcbiAgICAgICAgfTtcblxuICAgICAgUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyVXRpbHMubG9nRXZlbnQodGFibGUsIHBhcmFtcyk7XG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBwYXJhbXMuc3RvcmFnZS5mb2xkZXIpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgcGFyYW1zLnN0b3JhZ2UuZmlsZU5hbWUpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIHBhcmFtcy5zdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJlbnZcIiwgY29uZmlnLlNUT1JBR0VfRU5WKTtcbiAgICBzdG9yYWdlLmdvKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXG4vKiBnbG9iYWwgUmlzZVZpc2lvbiwgZ2FkZ2V0cyAqL1xuKGZ1bmN0aW9uICh3aW5kb3csIGRvY3VtZW50LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBpZCA9IG5ldyBnYWRnZXRzLlByZWZzKCkuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGRvY3VtZW50LmJvZHkub25tb3VzZWRvd24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJXZWJDb21wb25lbnRzUmVhZHlcIiwgZnVuY3Rpb24oKSB7XG4gICAgaWYgKGlkICYmIGlkICE9PSBcIlwiKSB7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BsYXlfXCIgKyBpZCwgcGxheSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIFJpc2VWaXNpb24uSW1hZ2UuZ2V0QWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICAgIH1cbiAgfSk7XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBSaXNlVmlzaW9uLkltYWdlLnBsYXkoKTtcbiAgfVxufSkod2luZG93LCBkb2N1bWVudCwgZ2FkZ2V0cyk7XG5cbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktMyddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
